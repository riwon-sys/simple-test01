<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë¦¬ì› ì¶”ê°€ë§¤ìˆ˜ ê°„ë‹¨ ê³„ì‚°ê¸° Â· KRW</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" />

  <!-- iOS í™ˆí™”ë©´ ìµœì í™” -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="icon-192.png" />

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('sw.js'));
    }
  </script>

  <style>
    :root{
      --bg:#fafbfc; --card:#ffffff; --bd:#e1e4e8; --text:#24292e; --muted:#6a737d;
      --pos:#22863a; --neg:#d73a49;
      --radius:12px; --gap:14px;
    }
    *{box-sizing:border-box}
    body{ margin:0; padding:24px; max-width:980px; margin-inline:auto;
      font-family: ui-sans-serif, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Arial;
      color:var(--text); background:var(--bg);
    }
    .h1{font-size:28px; font-weight:900; margin:0 0 8px}
    .hr{height:1px; background:#dfe2e5; border:0; margin:16px 0}
    .badges{display:flex; gap:8px; flex-wrap:wrap; margin:6px 0 12px}
    .badge{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid var(--bd);
      background:#f6f8fa; color:#24292e; border-radius:999px; font-size:12px; font-weight:700}
    .section-title{display:flex; align-items:center; gap:8px; font-size:18px; font-weight:800; margin:18px 0 8px}
    .note{color:var(--muted); font-size:12px}

    fieldset{ border:1px solid var(--bd); border-radius:var(--radius);
      background:var(--card); padding:14px; margin:10px 0; }
    legend{font-weight:800; color:#24292e; padding:0 6px}
    label{display:block; margin:10px 0 6px; font-weight:600}
    input{ width:100%; padding:10px; border:1px solid var(--bd); border-radius:8px; background:#fff; outline:none; }
    input:focus{border-color:#79b8ff; box-shadow:0 0 0 3px rgba(3,102,214,.15)}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:var(--gap)}
    @media (max-width:760px){ .grid{grid-template-columns:1fr} }

    .btn{ width:100%; margin-top:10px; padding:12px; border-radius:8px; border:1px solid #2c974b;
      background:linear-gradient(#34d058,#28a745); color:#fff; font-weight:800; cursor:pointer; }
    .btn:active{transform:translateY(1px)}

    .cards{display:grid; grid-template-columns:1fr 1fr; gap:var(--gap); margin-top:var(--gap)}
    @media (max-width:760px){ .cards{grid-template-columns:1fr} }
    .card{ border:1px solid var(--bd); border-radius:var(--radius); background:var(--card); padding:14px; }
    .card h3{margin:0 0 8px; font-size:16px}
    .kv{display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px dashed var(--bd)}
    .kv:last-child{border-bottom:none}
    .pos{color:var(--pos); font-weight:800}
    .neg{color:var(--neg); font-weight:800}
    .pill{ display:inline-block; min-width:108px; text-align:center; padding:6px 10px; border-radius:999px;
      border:1px solid var(--bd); background:#fff; font-weight:800; }
    .pill.pos{color:var(--pos)} .pill.neg{color:var(--neg)}
    .warn{color:var(--neg); font-weight:800; white-space:normal; margin-top:8px}
  </style>
</head>
<body>

<div class="h1">ë¦¬ì› ì¶”ê°€ë§¤ìˆ˜ ê°„ë‹¨ ê³„ì‚°ê¸°</div>
<div class="badges"><span class="badge">KRW ì „ìš©</span></div>
<div class="hr"></div>

<div class="section-title">ğŸ“Š í˜„ì¬ ì†ìµ ìš”ì•½</div>
<div class="badges" style="margin-top:0">
  <span id="topPnL" class="pill">ì†ìµ -</span>
  <span id="topRoi" class="pill">ìˆ˜ìµë¥  -</span>
</div>

<div class="section-title">ğŸ“¦ ë³´ìœ  ì •ë³´</div>
<fieldset>
  <legend>ë³´ìœ  ì •ë³´</legend>
  <div class="grid">
    <div>
      <label>ì½”ì¸ëª…</label>
      <input id="coin" placeholder="ì˜ˆ) BTC">
    </div>
    <div>
      <label>ë³´ìœ ìˆ˜ëŸ‰ *</label>
      <input id="holdQty" type="number" inputmode="decimal" step="any" placeholder="ì˜ˆ) 3092">
    </div>
  </div>
  <div class="grid">
    <div>
      <label>ë§¤ìˆ˜í‰ê· ê°€ (KRW) *</label>
      <input id="holdAvg" type="number" inputmode="decimal" step="any" placeholder="ì˜ˆ) 100">
    </div>
    <div>
      <label>í˜„ì¬ê°€ (KRW) *</label>
      <input id="now" type="number" inputmode="decimal" step="any" placeholder="ì˜ˆ) 100">
    </div>
  </div>
</fieldset>

<div class="section-title">â• ì¶”ê°€ë§¤ìˆ˜ ì •ë³´</div>
<fieldset>
  <legend>ì¶”ê°€ë§¤ìˆ˜ ì •ë³´</legend>
  <div class="grid">
    <div>
      <label>ì¶”ê°€ë§¤ìˆ˜ ë‹¨ê°€ (KRW) *</label>
      <input id="addPrice" type="number" inputmode="decimal" step="any" placeholder="ì˜ˆ) 270">
    </div>
    <div>
      <label>ì¶”ê°€ë§¤ìˆ˜ ìˆ˜ëŸ‰ (ì„ íƒ)</label>
      <input id="addQty" type="number" inputmode="decimal" step="any" placeholder="ìˆ˜ëŸ‰ ë˜ëŠ” ì•„ë˜ ê¸ˆì•¡ ì¤‘ í•˜ë‚˜">
    </div>
  </div>
  <label>ì¶”ê°€ë§¤ìˆ˜ ë§¤ìˆ˜ê¸ˆì•¡ (ì„ íƒ, KRW)</label>
  <input id="addInvest" type="number" inputmode="decimal" step="any" placeholder="ê¸ˆì•¡ ì…ë ¥ ì‹œ ìˆ˜ëŸ‰ ìë™ ê³„ì‚°">
  <button class="btn" id="calcBtn">ê³„ì‚°í•˜ê¸°</button>
  <div id="warn" class="warn" style="display:none;"></div>
  <div class="note">ì¶”ê°€ë§¤ìˆ˜ëŠ” <b>ìˆ˜ëŸ‰ ë˜ëŠ” ê¸ˆì•¡</b> ì¤‘ í•˜ë‚˜ë§Œ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤.</div>
</fieldset>

<div class="section-title">ğŸ“ˆ ê²°ê³¼</div>
<div class="cards">
  <div class="card">
    <h3>ì¶”ê°€ë§¤ìˆ˜ ì „ (ë³´ìœ  ê¸°ì¤€)</h3>
    <div class="kv"><span>ë³´ìœ ìˆ˜ëŸ‰</span><b id="bQty">-</b></div>
    <div class="kv"><span>ë§¤ìˆ˜í‰ê· ê°€</span><b id="bAvg">-</b></div>
    <div class="kv"><span>ë§¤ìˆ˜ê¸ˆì•¡</span><b id="bInvest">-</b></div>
    <div class="kv"><span>í‰ê°€ê¸ˆì•¡</span><b id="bEval">-</b></div>
    <div class="kv"><span>í‰ê°€ì†ìµ</span><b id="bPnL">-</b></div>
    <div class="kv"><span>ìˆ˜ìµë¥ </span><b id="bRoi">-</b></div>
  </div>
  <div class="card">
    <h3>ì¶”ê°€ë§¤ìˆ˜ í›„ (ë³€ê²½ ê¸°ì¤€)</h3>
    <div class="kv"><span>ë³´ìœ ìˆ˜ëŸ‰</span><b id="aQty">-</b></div>
    <div class="kv"><span>ë§¤ìˆ˜í‰ê· ê°€</span><b id="aAvg">-</b></div>
    <div class="kv"><span>ë§¤ìˆ˜ê¸ˆì•¡</span><b id="aInvest">-</b></div>
    <div class="kv"><span>í‰ê°€ê¸ˆì•¡</span><b id="aEval">-</b></div>
    <div class="kv"><span>í‰ê°€ì†ìµ</span><b id="aPnL">-</b></div>
    <div class="kv"><span>ìˆ˜ìµë¥ </span><b id="aRoi">-</b></div>
  </div>
</div>

<script>
  const $ = (id) => document.getElementById(id);
  const money = (v) => `${Number(v).toLocaleString()} KRW`;
  const qtyFmt = (v) => Number(v).toLocaleString(undefined,{maximumFractionDigits:4});
  const signed = (v) => {
    const cls = v >= 0 ? 'pos' : 'neg';
    const sign = v >= 0 ? '+' : '';
    return `<span class="${cls}">${sign}${Number(v).toLocaleString()} KRW</span>`;
  };
  const signedPct = (p) => {
    const cls = p >= 0 ? 'pos' : 'neg';
    const sign = p >= 0 ? '+' : '';
    return `<span class="${cls}">${sign}${Number(p).toFixed(2)} %</span>`;
  };
  const pillClass = (v) => v >= 0 ? 'pill pos' : 'pill neg';

  function calc(){
    const holdQty = +$('holdQty').value;
    const holdAvg = +$('holdAvg').value;
    const now     = +$('now').value;
    const addPrice= +$('addPrice').value;
    const addQtyI = +$('addQty').value;
    const addInvI = +$('addInvest').value;

    const warnings = [];
    if(!holdQty || !holdAvg || !now || !addPrice){
      warnings.push('ë³´ìœ ìˆ˜ëŸ‰Â·í‰ê· ê°€Â·í˜„ì¬ê°€Â·ì¶”ê°€ë§¤ìˆ˜ ë‹¨ê°€ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
    }
    let addQty=0, addInv=0;
    if(addInvI>0){ addInv=addInvI; addQty=addInv/addPrice; }
    else if(addQtyI>0){ addQty=addQtyI; addInv=addQty*addPrice; }
    else { warnings.push('ì¶”ê°€ë§¤ìˆ˜ëŠ” ìˆ˜ëŸ‰ ë˜ëŠ” ê¸ˆì•¡ ì¤‘ í•˜ë‚˜ë§Œ ì…ë ¥í•˜ì„¸ìš”.'); }

    if(warnings.length){
      $('warn').style.display='block';
      $('warn').innerHTML = warnings.join('<br>');
      return;
    }else{
      $('warn').style.display='none';
      $('warn').textContent = '';
    }

    // BEFORE
    const bInv = holdQty * holdAvg;
    const bEval= holdQty * now;
    const bPnL = bEval - bInv;
    const bRoi = bInv ? (bPnL / bInv) * 100 : 0;

    $('topPnL').className = pillClass(bPnL);
    $('topPnL').textContent = `ì†ìµ ${Number(bPnL).toLocaleString()} KRW`;
    $('topRoi').className = pillClass(bRoi);
    $('topRoi').textContent = `ìˆ˜ìµë¥  ${bRoi.toFixed(2)}%`;

    $('bQty').textContent = `${qtyFmt(holdQty)} ê°œ`;
    $('bAvg').textContent = money(holdAvg);
    $('bInvest').textContent = money(bInv);
    $('bEval').textContent = money(bEval);
    $('bPnL').innerHTML = signed(bPnL);
    $('bRoi').innerHTML = signedPct(bRoi);

    // AFTER
    const aQty = holdQty + addQty;
    const aInv = bInv + addInv;
    const aAvg = aQty ? aInv / aQty : 0;
    const aEval= aQty * now;
    const aPnL = aEval - aInv;
    const aRoi = aInv ? (aPnL / aInv) * 100 : 0;

    $('aQty').textContent = `${qtyFmt(aQty)} ê°œ`;
    $('aAvg').textContent = money(aAvg.toFixed(2));
    $('aInvest').textContent = money(aInv);
    $('aEval').textContent = money(aEval);
    $('aPnL').innerHTML = signed(aPnL);
    $('aRoi').innerHTML = signedPct(aRoi);
  }

  // ì…ë ¥ ì¦‰ì‹œ ê³„ì‚° + ë²„íŠ¼
  ['coin','holdQty','holdAvg','now','addPrice','addQty','addInvest'].forEach(id=>{
    $(id).addEventListener('input', calc);
    $(id).addEventListener('change', calc);
  });
  $('calcBtn').addEventListener('click', calc);
  calc();
</script>
</body>
</html>
